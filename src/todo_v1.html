<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo v1</title>
</head>
<body>

    <div>
        <h1>todo</h1>

        <div id="todolist"></div>

        <form class="add-todo-form" id="todoForm">
            <input type="text" name="todo_content" id="todoInput">
            <input type="submit" value="Add" id="todoSubmit">
        </form>

        <button id="downloadButton">Export (download) todo-data</button>
    </div>

    <script>
        const todoInput = document.getElementById('todoInput');
        const todoForm = document.getElementById('todoForm');
        const todolist = document.getElementById('todolist');
        const downloadBtn = document.getElementById('downloadButton');

        let todos = loadTodos();

        function loadTodos() {
            const data = localStorage.getItem('todos');
            try {
                return data ? JSON.parse(data) : [];
            } catch (e) {
                return [];
            }
        }

        function storeTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        window.toggleTodo = function(index) {
            todos[index].done = !todos[index].done;
            storeTodos();
            renderTodos();
        };

        function renderTodos() {
            todolist.innerHTML = todos.map((todo, index) => `
                <div class="todo-item">
                    <input type="checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${index})">
                    <span class="todo ${todo.done ? 'done' : ''}">${todo.content}</span>
                </div>
            `).join('');
        }

        function createTodo(e) {
            e.preventDefault();
            const content = todoInput.value.trim();

            if (!content) return;

            todos.push({
                content: content,
                done: false,
            });

            todoInput.value = '';
            storeTodos();
            renderTodos();
        }

        function exportData() {
            const data = JSON.stringify(todos, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const date = new Date().toISOString().split('T')[0];

            const link = document.createElement('a');
            link.href = url;
            link.download = `todos_${date}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        todoForm.addEventListener('submit', createTodo);
        downloadBtn.addEventListener('click', exportData);
        
        renderTodos();
    </script>
</body>
</html>